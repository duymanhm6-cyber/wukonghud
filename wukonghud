--------------------------------------------------
-- SERVICES
--------------------------------------------------
local StarterGui = game:GetService("StarterGui")

--------------------------------------------------
-- FILE CONFIG
--------------------------------------------------
local KEY_FILE = "keyWuKongHud.txt"

--------------------------------------------------
-- CHECK KEY FUNCTION (GIá»® LOGIC Gá»C - LUARMOR)
--------------------------------------------------
local function checkAndLoadKey(userKey, onSuccess)
    local api = loadstring(game:HttpGet(
        "https://sdkapi-public.luarmor.net/library.lua"
    ))()

    api.script_id = "d423aa2069e4c1ddfd1315a51db5dcdb"

    if #userKey ~= 32 then
        StarterGui:SetCore("SendNotification", {
            Title = "âŒ Auth Error",
            Text = "Key must be exactly 32 characters!",
            Duration = 5
        })
        return false
    end

    local status = api.check_key(userKey)
    print("Debug:", status.code, status.message)

    if status.code == "KEY_VALID" then
        script_key = userKey

        if writefile then
            writefile(KEY_FILE, userKey)
        end

        StarterGui:SetCore("SendNotification", {
            Title = "âœ… Success",
            Text = "Key verified! Loading script...",
            Duration = 5
        })

        if typeof(onSuccess) == "function" then
            onSuccess()
        end

        api.load_script()
        return true
    else
        if isfile and isfile(KEY_FILE) and delfile then
            delfile(KEY_FILE)
        end

        StarterGui:SetCore("SendNotification", {
            Title = "âŒ Invalid Key",
            Text = (status.message or "Unknown error") .. " (" .. status.code .. ")",
            Duration = 8
        })
        return false
    end
end

--------------------------------------------------
-- AUTO LOAD SAVED KEY
--------------------------------------------------
if isfile and isfile(KEY_FILE) then
    local savedKey = readfile(KEY_FILE)
    if savedKey and #savedKey > 0 then
        if checkAndLoadKey(savedKey) then
            return
        end
    end
end

--------------------------------------------------
-- GUI (ORIONLIB)
--------------------------------------------------
local OrionLib = loadstring(game:HttpGet(
    "https://gist.githubusercontent.com/zxcv-5/026a962b48ed8aff1337b8436b91da32/raw",
    true
))()

local Window = OrionLib:MakeWindow({
    Name = "ğŸ”‘ Wukong HUD | Key System",
    HidePremium = false,
    SaveConfig = false,
    IntroEnabled = true,
    IntroText = "Wukong HUD"
})

--------------------------------------------------
-- HUD INFORMATION
--------------------------------------------------
local InfoTab = Window:MakeTab({
    Name = "ğŸ“Œ HUD Information",
    Icon = "rbxassetid://6034509993",
    PremiumOnly = false
})

InfoTab:AddParagraph(
    "ğŸ”¥ Main Features",
    "âš¡ Ultra Fast Auto Raid\n" ..
    "ğŸŒŠ Auto Sea King (Sea 2 & Sea 3)\n" ..
    "ğŸ’ Auto Get Items\n" ..
    "ğŸ§  Smart Farming Logic\n\n" ..
    "âœ… Supports parallel execution:\n" ..
    "â€¢ Auto Raid + Auto Sea King at the same time\n" ..
    "â€¢ No conflict between features\n" ..
    "â€¢ Optimized & stable performance"
)

--------------------------------------------------
-- VERIFY KEY TAB
--------------------------------------------------
local VerifyTab = Window:MakeTab({
    Name = "ğŸ” Verify Key",
    Icon = "rbxassetid://6034509993",
    PremiumOnly = false
})

VerifyTab:AddParagraph(
    "â„¹ï¸ Key Authentication",
    "Enter your key below to unlock Wukong HUD"
)

local userKey = ""

VerifyTab:AddTextbox({
    Name = "ğŸ”‘ Enter Key",
    Default = "",
    TextDisappear = false,
    Callback = function(Value)
        userKey = Value
    end
})

VerifyTab:AddButton({
    Name = "âœ… Verify & Load",
    Callback = function()
        if userKey == "" then
            OrionLib:MakeNotification({
                Name = "âŒ Error",
                Content = "Please enter your key",
                Time = 3
            })
            return
        end

        checkAndLoadKey(userKey, function()
            OrionLib:Destroy()
        end)
    end
})

--------------------------------------------------
-- GET KEY FREE
--------------------------------------------------
local FreeKeyTab = Window:MakeTab({
    Name = "ğŸ†“ Get Free Key",
    Icon = "rbxassetid://6034509993",
    PremiumOnly = false
})

FreeKeyTab:AddParagraph(
    "ğŸ Free Key System",
    "â³ Free key duration: 6 hours\n" ..
    "ğŸ” Can be re-obtained multiple times\n" ..
    "â±ï¸ Maximum usage: up to 48 hours"
)

FreeKeyTab:AddButton({
    Name = "ğŸŒ Copy Get Key Link",
    Callback = function()
        if setclipboard then
            setclipboard("https://ads.luarmor.net/get_key?for=Wukong_HUD-KffnwRmvXtCz")
            OrionLib:MakeNotification({
                Name = "ğŸ“‹ Copied",
                Content = "Get-key link copied to clipboard",
                Time = 3
            })
        end
    end
})

--------------------------------------------------
-- BUY KEY
--------------------------------------------------
local BuyKeyTab = Window:MakeTab({
    Name = "ğŸ’ Buy Premium Key",
    Icon = "rbxassetid://6034509993",
    PremiumOnly = false
})

BuyKeyTab:AddParagraph(
    "ğŸ’° Premium Access",
    "âœ” Stable & long-term usage\n" ..
    "âœ” No ads / No waiting\n" ..
    "âœ” Priority support"
)

BuyKeyTab:AddButton({
    Name = "ğŸ“˜ Facebook Contact",
    Callback = function()
        if setclipboard then
            setclipboard("https://www.facebook.com/DuyManhbking")
        end
    end
})

BuyKeyTab:AddButton({
    Name = "ğŸ’¬ Join Discord",
    Callback = function()
        if setclipboard then
            setclipboard("https://discord.gg/ZsUnSGRJ")
        end
    end
})

--------------------------------------------------
OrionLib:Init()
